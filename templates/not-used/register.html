{% extends 'layout.html' %}
{% block title %} Registrazione utenti {% endblock %}

{% block content %}
    {{ include('admin/users-navigation.html') }}

    <section class="d-flex justify-content-center col-12 mx-auto my-1">
        <form id="register-form" action="{{ doc_root }}admin/register" method="POST">

            <!--    =====>    PROGRESS BAR    <=====    -->
            <div class="container col-9 mx-auto mb-2 pb-2">
                <div class="progress">
                    <div class="progress-bar progress-bar-striped" role="progressbar" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
            </div>
            <!--    ===>    END PROGRESS BAR    <===    -->
                                        
            <!--    ===>    FIELDSET 1 [ADD NEW USER]   <===    -->
            <fieldset>
                <div class="form-card mx-auto pt-0 mt-1">
                    <div class="row mx-auto form-title">
                        <h2 class="mt-4 mb-3 mx-auto"> 
                            <i class="bi bi-people"></i> 
                                &nbsp;Registrazione&nbsp; 
                            <i class="bi bi-people"></i> 
                        </h2>

                        <h3 class="pt-0 mt-0"> 
                            Inserire i dati richiesti per creare il nuovo utente. 
                        </h3>
                    </div>
            
                    <div class="form-group row mx-auto mt-4 px-3 py-0">                 
                        <div class="col-6 mx-auto my-1">
                            <label for="name" class="form-control-label mb-0"> Nome </label>
                                <input type="text" class="form-control mb-4" name="name" value="" />
                            
                            <div class="invalid-feedback"> {{ error.name }} </div>
                        </div>
                                               
                        <div class="col-6 mx-auto my-1">
                            <label for="surname" class="form-control-label mb-0"> Cognome </label>
                                <input type="text" class="form-control mb-4" name="surname" value="" />
                            
                            <div class="invalid-feedback"> {{ error.surname }} </div>
                        </div>
                                                
                        <div class="col-6 mx-auto my-1">
                            <label for="email" class="form-control-label mb-0"> Indirizzo e-mail </label>
                                <input type="text" class="form-control mb-4" name="email" value="" />
                            
                            <div class="invalid-feedback"> {{ error.email }} </div>
                        </div>
                                            
                        <div class="col-6 mx-auto my-1">
                            <label for="username" class="form-control-label mb-0"> Username </label>
                                <input type="text" class="form-control mb-4" name="username" value="" />
                            
                            <div class="invalid-feedback"> {{ error.username }} </div>
                        </div>
                        
                        <div class="col-6 mx-auto my-1">
                            <label for="gender" class="form-control-label mb-0"> Genere </label>
                                <select class="form-control mb-4" name="id_gender" id="gender" > 
                                    <option value="" class="opt-type"></option>    

                                    {% for g in gender %}
                                        <option value="{{ g.id_gender }}" class="opt-type"> 
                                            {{ g.name|capitalize }} ({{ g.abbr|upper }})
                                        </option>
                                    {% endfor %}
                                </select>
                        </div> 
                        
                        <div class="col-6 mx-auto my-1">
                            <label for="bday" class="form-control-label mb-0"> Data di nascita </label>
                                <input type="text" class="form-control mb-4 date" name="bday" value="" />
                            
                            <div class="invalid-feedback"> {{ error.bday }} </div>
                        </div>
                                                
                        <div class="col-6 mx-auto my-1">
                            <label for="city" class="form-control-label mb-0"> Citta di nascita </label>
                                <input type="text" class="form-control mb-4" name="city" value="" />
                            
                            <div class="invalid-feedback"> {{ error.city }} </div>
                        </div>
                                            
                        <div class="col-6 mx-auto my-1"> 
                            <label for="country" class="form-control-label mb-0"> Stato di nascita </label>
                                <input type="text" class="form-control mb-4" name="country" value="" />
                            
                            <div class="invalid-feedback"> {{ error.country }} </div>
                        </div>
                    </div>    
                </div>

                <button type="button" name="next" class="action-button next"> Avanti </button>
            </fieldset>
            <!--    ===>    END FIELDSET 1 [ADD NEW USER]    <===    -->
            
            <!--    ===>    FIELDSET 2 [ADD NEW USER]    <===    -->
            <fieldset>
                <div class="form-card mx-auto pt-0 mt-1">
                    <div class="row mx-auto form-title">
                        <h2 class="mt-4 mb-3 mx-auto"> 
                            <i class="bi bi-people"></i> 
                                &nbsp;Registrazione&nbsp; 
                            <i class="bi bi-people"></i> 
                        </h2>

                        <h3 class="pt-0 mt-0"> 
                            Inserire i dati richiesti per creare il nuovo utente. 
                        </h3>
                    </div>
                                    
                    <div class="form-group row mx-auto mt-4 px-3 py-0">
                        <div class="col-6 mx-auto my-1">
                            <label for="password" class="form-control-label mb-0"> Password </label>
                                <input type="password" class="form-control mb-4" name="password" />
                            
                            <div class="invalid-feedback"> {{ error.password }} </div>
                        </div>
                        
                        <div class="col-6 mx-auto my-1">
                            <label class="form-control-label mb-0" for="confirm"> Conferma password </label>
                                <input type="password" class="form-control mb-4" name="confirm" />
                            
                            <div class="invalid-feedback"> {{ error.confirm }} </div>
                        </div>  
                        
                        <div class="col-6 mx-auto my-1">
                            <label class="form-control-label mb-0" for="title"> Ruolo aziendale </label>
                                <select class="form-control mb-4" name="id_title" id="titles" >
                                    <option value="" class="opt-type"></option>

                                    {% for t in titles %}
                                        <option value="{{ t.id_title }}" class="opt-type"> 
                                            {{ t.name|capitalize }} 
                                        </option>
                                    {% endfor %}
                                </select>
                        </div> 
                        
                        <div class="col-6 mx-auto my-1">
                            <label class="form-control-label mb-0" for="role"> Accesso </label>
                                <select class="form-control" name="id_role" id="roles" >
                                    <option value="" class="opt-type"></option>

                                    {% for r in roles %}
                                        <option value="{{ r.id_role }}" class="opt-type"> 
                                            {{ r.name|capitalize }} 
                                        </option>
                                    {% endfor %}
                                </select>
                        </div>
                    </div>          
                </div>

                <button type="button" name="previous" class="action-button previous"> Indietro </button>
                <button type="submit" name="submit" class="action-button submit"> Salva </button>     
            </fieldset>
            <!--    ===>    END FIELDSET 2 [ADD NEW USER]    <===    -->
        </form>
    </section>
{% endblock %}

{% block jsScript %}    
<!--<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">      <!-- Bootstrap 5 CSS -->
<link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/vanillajs-datepicker@1.1.4/dist/css/datepicker.min.css'>              <!-- Vanilla Datepicker CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vanillajs-datepicker@1.3.4/dist/css/datepicker-bs5.min.css">          <!-- Vanilla Datepicker CSS -->
<script src="https://cdn.jsdelivr.net/npm/vanillajs-datepicker@1.3.4/dist/js/datepicker.min.js"></script>
    
<script>
    $(document).ready(function(){
//  ===> MULTI-STEP FIELDSET CHANGE   
        var current = 1, current_step, next_step, steps;
        steps = $("fieldset").length;

        //next fieldset in multi-step form
        $(".next").click(function(){
            current_step = $(this).closest("fieldset");  
            next_step = $(this).closest("fieldset").next();
                    
            next_step.show();
            current_step.hide();
            setProgressBar(++current);
        });

        //previous fieldset in multi-step form
        $(".previous").click(function(){
            current_step = $(this).closest("fieldset");
            previous_step = $(this).closest("fieldset").prev();
            current = 2;

            previous_step.show();
            current_step.hide();
            setProgressBar(--current);
        });
    
        //setting progress bar to % of current fieldset
        setProgressBar(current);
        
        //change progress bar action
        function setProgressBar(current){
            var percent = parseFloat(100 / steps) * current;
            percent = percent.toFixed();
                
            $(".progress-bar")
                .css("width",percent+"%")
                .html(percent+"%");     
        }   
//  ===> END MULTI-STEP FIELDSET CHANGE     
        
//  ===> RESET BUTTON     
        $(".reset").click(function(){
            $("#gender").val('');
            $("#roles").val('');
            $("#titles").val('');
        });
//  ===> END RESET BUTTON 
        
//  ===> DATEPICKER     
        //use datepicker on the date inputs
        $(".date").datepicker({
            format: 'dd-mm-yyyy',
            autoclose: true,
            language: 'it-IT',
        });
//  ===> END DATEPICKER   
    });     
</script>   
        
<!--      BOOTSTRAP DATEPICKER      -->   
<script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.10.0/js/bootstrap-datepicker.min.js" integrity="sha512-LsnSViqQyaXpD4mBBdRYeP6sRwJiJveh2ZIbW41EBrNmKxgr/LFZIiWT6yr+nycvhvauz8c2nYMhrP80YhG7Cw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.10.0/js/bootstrap-datepicker.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.10.0/locales/bootstrap-datepicker.it.min.js" charset="UTF-8"></script>
{% endblock %}