<div class="modal fade" id="editUser-{{ m.id_user }}" tabindex="-1" role="dialog" aria-labelledby="edit-user" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header row">
                <h2 class="modal-title mx-auto my-auto" id="edit-user"> 
                    <i class="bi bi-pencil-square my-auto mx-1"></i>
                        MODIFICA
                    <i class="bi bi-pencil-square my-auto mx-1"></i>
                </h2>

                    <h4 class="modal-subtitle mx-auto my-2"> 
                        Modifica i dati esistenti dell'utente.
                    </h4>
            </div>
        
            <div class="modal-body">
                <div class="container-fluid my-1">

                    <form id="user-edit" action="{{ doc_root }}admin/user-edit/{{ m.id_user }}" method="POST" autocomplete="off">
                        <input type="hidden" name="id_user" id="id_user" value="{{ m.id_user }}" />

                        <div class="row form-group mx-auto">
                            <!-- error['name'] number -->
                            <div class="col my-auto mx-0 px-0 err-circle" id="editName">
                                <span class="alert my-1 err-circle-span" role="alert"></span>
                            </div>
                            <!--  end  -->

                            <div class="col-1 my-auto">
                                {% if errors.name %} 
                                    <span class="alert alert-danger my-1 circle" role="alert">
                                        * I
                                    </span>
                                {% endif %}
                            </div>

                            <div class="col-4 my-auto">
                                <label class="form-control-label my-auto"> Nome: </label>
                            </div>
                            
                            <div class="col-7 my-auto">
                                <input name="name" type="text" class="form-control" value="{{ m.name|upper }}" />
                            </div>
                        </div>
                        
                        <div class="row form-group mx-auto">
                            <!-- error['surname'] number -->
                            <div class="col my-auto mx-0 px-0 err-circle" id="editSurname">
                                <span class="alert my-1 err-circle-span" role="alert"></span>
                            </div>
                            <!--  end  -->

                            <div class="col-1 my-auto">
                                {% if errors.surname %} 
                                    <span class="alert alert-danger my-1 circle" role="alert">
                                        * II
                                    </span>
                                {% endif %}
                            </div>

                            <div class="col-4 my-auto">
                                <label class="form-control-label my-auto"> Cognome: </label>
                            </div>
                        
                            <div class="col-7 my-auto">
                                <input name="surname" type="text" class="form-control" value="{{ m.surname|upper }}" />
                            </div>
                        </div>
                        
                        <div class="row form-group mx-auto">
                            <!-- error['email'] number -->
                            <div class="col my-auto mx-0 px-0 err-circle" id="editEmail">
                                <span class="alert my-1 err-circle-span" role="alert"></span>
                            </div>
                            <!--  end  -->

                            <div class="col-1 my-auto">
                                {% if errors.email %} 
                                    <span class="alert alert-danger my-1 circle" role="alert">
                                        * III
                                    </span>
                                {% endif %}
                            </div>

                            <div class="col-4 my-auto">
                                <label class="form-control-label my-auto"> Indirizzo e-mail: </label>
                            </div>
                            
                            <div class="col-7 my-auto">
                                <input type="text" class="form-control" name="email" value="{{ m.email }}" />
                            </div>
                        </div>

                        <div class="row form-group mx-auto">
                            <!-- error['username'] number -->
                            <div class="col my-auto mx-0 px-0 err-circle" id="editUsername">
                                <span class="alert my-1 err-circle-span" role="alert"></span>
                            </div>
                            <!--  end  -->

                            <div class="col-1 my-auto">
                                {% if errors.username %} 
                                    <span class="alert alert-danger my-1 circle" role="alert">
                                        * IV
                                    </span>
                                {% endif %}
                            </div>

                            <div class="col-4 my-auto">
                                <label class="form-control-label my-auto"> Username: </label>
                            </div>
                            
                            <div class="col-7 my-auto">
                                <input type="text" class="form-control" name="username" value="{{ m.username|lower }}" />
                            </div>
                        </div>

                        <div class="row form-group mx-auto">
                            <!-- error['gender'] number -->
                            <div class="col my-auto mx-0 px-0 err-circle" id="editGender">
                                <span class="alert my-1 err-circle-span" role="alert"></span>
                            </div>
                            <!--  end  -->

                            <div class="col-1 my-auto">
                                {% if errors.gender %} 
                                    <span class="alert alert-danger my-1 circle" role="alert">
                                        * V
                                    </span>
                                {% endif %}
                            </div>

                            <div class="col-4 my-auto">
                                <label class="form-control-label my-auto"> Genere: </label>
                            </div>

                            <div class="col-7 my-auto">
                                <select class="form-control" name="id_gender"> 
                                    {% for g in gender %}
                                        <option value="{{ g.id_gender }}" class="opt-type" 
                                            {% if (m.id_gender == g.id_gender) %} selected {% endif %}> 
                                                {{ g.name|capitalize }} - {{ g.abbr|upper}}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>      
                        </div> 

                        <div class="row form-group mx-auto">
                            <!-- error['bday'] number -->
                            <div class="col my-auto mx-0 px-0 err-circle" id="editBday">
                                <span class="alert my-1 err-circle-span" role="alert"></span>
                            </div>
                            <!--  end  -->

                            <div class="col-1 my-auto">
                                {% if errors.bday %} 
                                    <span class="alert alert-danger my-1 circle" role="alert">
                                        * VI
                                    </span>
                                {% endif %}
                            </div>

                            <div class="col-4 my-auto">
                                <label class="form-control-label my-auto"> Data di nascita: </label>
                            </div>
                            
                            <div class="col-7 my-auto">
                                <input type="text" class="form-control date" name="birthday" value="{{ m.birthday|date('d-m-Y') }}" />
                            </div>
                        </div>

                        <div class="row form-group mx-auto">
                            <!-- error['city'] number -->
                            <div class="col my-auto mx-0 px-0 err-circle" id="editCity">
                                <span class="alert my-1 err-circle-span" role="alert"></span>
                            </div>
                            <!--  end  -->

                            <div class="col-1 my-auto">
                                {% if errors.city %} 
                                    <span class="alert alert-danger my-1 circle" role="alert">
                                        * VII
                                    </span>
                                {% endif %}
                            </div>

                            <div class="col-4 my-auto">
                                <label class="form-control-label my-auto"> Luogo di nascita: </label>
                            </div>
                            
                            <div class="col-7 my-auto">
                                <input type="text" class="form-control" name="city" value="{{ m.city|capitalize }}" />
                            </div>
                        </div>

                        <div class="row form-group mx-auto">
                            <!-- error['country'] number -->
                            <div class="col my-auto mx-0 px-0 err-circle" id="editCountry">
                                <span class="alert my-1 err-circle-span" role="alert"></span>
                            </div>
                            <!--  end  -->

                            <div class="col-1 my-auto">
                                {% if errors.country %} 
                                    <span class="alert alert-danger my-1 circle" role="alert">
                                        * VIII
                                    </span>
                                {% endif %}
                            </div>

                            <div class="col-4 my-auto">
                                <label class="form-control-label my-auto"> </label>
                            </div>
                            
                            <div class="col-7 my-auto">
                                <input type="text" class="form-control" name="country" value="{{ m.country|capitalize }}" />
                            </div>
                        </div>

                        <div class="row form-group mx-auto">
                            <!-- error['title'] number -->
                            <div class="col my-auto mx-0 px-0 err-circle" id="editTitle">
                                <span class="alert my-1 err-circle-span" role="alert"></span>
                            </div>
                            <!--  end  -->

                            <div class="col-1 my-auto">
                                {% if errors.title %} 
                                    <span class="alert alert-danger my-1 circle" role="alert">
                                        * IX
                                    </span>
                                {% endif %}
                            </div>

                            <div class="col-4 my-auto">
                                <label class="form-control-label my-auto"> Ruolo aziendale: </label>
                            </div>

                            <div class="col-7 my-auto">
                                <select class="form-control" name="id_title"> 
                                    {% for t in titles %}
                                        <option value="{{ t.id_title }}" class="opt-type" 
                                            {% if (m.id_title == t.id_title) %} selected {% endif %}> 
                                                {{ t.name|capitalize }} 
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>      
                        </div> 
                                                
                        <div class="row form-group mx-auto">
                            <!-- error['role'] number -->
                            <div class="col my-auto mx-0 px-0 err-circle" id="editRole">
                                <span class="alert my-1 err-circle-span" role="alert"></span>
                            </div>
                            <!--  end  -->

                            <div class="col-1 my-auto">
                                {% if errors.role %} 
                                    <span class="alert alert-danger my-1 circle" role="alert">
                                        * X
                                    </span>
                                {% endif %}
                            </div>

                            <div class="col-4 my-auto">
                                <label class="form-control-label my-auto"> Accesso: </label>
                            </div>

                            <div class="col-7 my-auto">
                                <select class="form-control" name="id_role" id="roles">    
                                    {% for r in roles %}
                                        <option value="{{ r.id_role }}" class="opt-type" 
                                            {% if (m.id_role == r.id_role) %} selected {% endif %}> 
                                                {{ r.name|capitalize }} 
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>   

                                <!-- error messages -->
                                <div class="col-10 mx-auto my-2 alert message-box">
                                    <span class="err errEditName"></span>
                                    <span class="err errEditSurname"></span>
                                    <span class="err errEditEmail"></span>
                                    <span class="err errEditUsername"></span>
                                    <span class="err errEditBday"></span>
                                    <span class="err errEditCity"></span>
                                    <span class="err errEditCountry"></span>
                                    <span class="err errEditGender"></span>
                                    <span class="err errEditTitle"></span>
                                    <span class="err errEditRole"></span>
                                    <span class="successEdit"></span>
                                </div>
                                <!-- end -->
                            
                            <div class="col-12" style="height: 7rem">
                                {% if errors %}
                                    <div class="col-11 alert alert-danger mx-auto my-2 error" role="alert">
                                       
                                        <span>
                                            {% if errors.name %}
                                                <b>*I:</b> {{ errors.name }} &nbsp;
                                            {% endif %}
        
                                            {% if errors.surname %}
                                                <b>*II:</b> {{ errors.surname }} &nbsp;
                                            {% endif %}
        
                                            {% if errors.email %}
                                                <b>*III:</b> {{ errors.email }} &nbsp;
                                            {% endif %}
        
                                            {% if errors.username %}
                                                <b>*IV:</b> {{ errors.username }} &nbsp;
                                            {% endif %}
        
                                            {% if errors.gender %}
                                                <b>*V:</b> {{ errors.gender }} &nbsp;
                                            {% endif %}
        
                                            {% if errors.bday %}
                                                <b>*VI:</b> {{ errors.bday }} &nbsp;
                                            {% endif %}
        
                                            {% if errors.city %}
                                                <b>*VII:</b> {{ errors.city }} &nbsp;
                                            {% endif %}
        
                                            {% if errors.country %}
                                                <b>*VIII:</b> {{ errors.country }} &nbsp;
                                            {% endif %}
                                   
                                            {% if errors.title %}
                                                <b>*IX:</b> {{ errors.title }} &nbsp;
                                            {% endif %}
        
                                            {% if errors.role %}
                                                <b>*X:</b> {{ errors.role }}
                                            {% endif %}
                                            
                                        </span>
        
                                        {% if errors.msg %}
                                            {{ errors.msg }}
                                        {% endif %}
                                    </div>
                                {% endif %}
                                </div>
                                
                            </div> 
                        </div> 

                        <div class="modal-footer">
                            <button type="button" class="btn btn-default modal-cancel" data-bs-dismiss="modal">
                                <span class="bi bi-x-circle">
                                    CHIUDI 
                                </span>    
                            </button>
                            
                            <button type="submit" class="btn btn-default modal-save updateUser" name="update_user">
                                <span class="bi bi-check-circle">
                                    SALVA
                                </span>   
                            </button>
                        </div>

                    </form>
                   
                </div>
            </div>
        </div>
    </div>
</div>

<script>
$(document).ready(function(){
//  ===> DATEPICKER     
    //use datepicker on the date inputs
    $(".date").datepicker({
        format: 'dd-mm-yyyy',
        autoclose: true,
        language: 'it-IT', 
    });
//  ===> END DATEPICKER 

//  ===> SAVE BUTTON ON EDIT/DELETE MODAL   
    $(".updateUser").on('click', function(){ 
        $.ajax({
            method: 'POST',
            url: 'admin/user-edit.php',
            data: {member : $("#user-edit").serialize()},
                success: function(data){
                    console.log(data);
                }
        })
    });  
//  ===> END SAVE BUTTON ON EDIT/DELETE MODAL
});
</script>
