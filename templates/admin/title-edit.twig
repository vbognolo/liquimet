<div class="modal fade" id="editTitle-{{ t.id_title }}" tabindex="-1" role="dialog" aria-labelledby="edit-title" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header row">
                <h2 class="modal-title mx-auto my-auto" id="edit-title"> 
                    <i class="bi bi-pencil-square my-auto mx-1"></i>
                        MODIFICA
                    <i class="bi bi-pencil-square my-auto mx-1"></i>
                </h2>

                    <h4 class="modal-subtitle mx-auto my-2"> 
                        Modifica i dati esistenti del ruolo aziendale.
                    </h4>
            </div>

            <div class="modal-body m-3">
                <div class="container-fluid col-12">
                    
                    <form id="title-update" action="{{ doc_root }}admin/title-edit/{{ t.id_title }}" method="POST" autocomplete="off">
                        <input type="hidden" name="id_title" id="id_title" value="{{ t.id_title }}" />   

                        <div class="row form-group mx-auto">
                                <!-- error['name'] number -->
                                <div class="col my-auto mx-0 px-0 err-circle" id="numUpdateN">
                                    <span class="alert my-1 err-circle-span" role="alert"></span>
                                </div>
                                <!--  end  -->

                            <div class="col-4 my-auto" style="padding-left: 0; margin-left: 0">
                                <label class="form-control-label my-auto"> Ruolo aziendale: </label>
                            </div>
                            
                            <div class="col-7 my-auto mx-2">
                                <input name="name" type="text" class="form-control name" value="{{ t.name|capitalize }}" />
                            </div>
                        </div>

                        <div class="row form-group mx-auto">
                                <!-- error['title'] number -->
                                <div class="col my-auto mx-0 px-0 err-circle" id="numUpdateT">
                                    <span class="alert my-1 err-circle-span" role="alert"></span>
                                </div>
                                <!--  end  -->

                            <div class="col-4 my-auto" style="padding-left: 0; margin-left: 0">
                                <label class="form-control-label my-auto"> Titolo: </label>
                            </div>
                            
                            <div class="col-7 my-auto mx-2">
                                <input name="title" type="text" class="form-control title" value="{{ t.title|capitalize }}" />
                            </div>
                        </div>

                        <div class="row form-group mx-auto mb-4">
                                <!-- error['acronym'] number -->
                                <div class="col my-auto mx-0 px-0 err-circle" id="numUpdateA">
                                    <span class="alert my-1 err-circle-span" role="alert"></span>
                                </div>
                                <!--  end  -->

                            <div class="col-4 my-auto" style="padding-left: 0; margin-left: 0">
                                <label class="form-control-label my-auto"> Acronimo: </label>
                            </div>
                            
                            <div class="col-7 my-auto mx-2">
                                <input name="acronym" type="text" class="form-control acronym" value="{{ t.acronym|upper }}" />
                            </div>
                        </div>

                            <!-- error messages -->
                            <div class="col-10 mx-auto my-2 alert message-box" id="alertUpdate">
                                <span class="err errUpdateName"></span>
                                <span class="err errUpdateTitle"></span>
                                <span class="err errUpdateAcronym"></span>
                                <span class="successUpdate"></span>
                            </div>
                            <!-- end -->

                        <div class="modal-footer">
                            <button type="button" class="btn btn-default modal-cancel exit" data-bs-dismiss="modal">
                                <span class="bi bi-x-circle">
                                    CHIUDI 
                                </span>    
                            </button>
                            
                            <button type="submit" class="btn btn-default modal-save" name="submit">
                                <span class="bi bi-check-circle">
                                    SALVA
                                </span>   
                            </button>
                        </div>                       
                    </form>
                    
                </div>
            </div>
        </div>
    </div>
</div>

{% block jsScript %}
<script>
$(document).ready(function(){
//  ===> FORM VALIDATION AND SUBMIT 
    $('form#title-update').on('submit', function(e){
        e.preventDefault();                                                         //prevent form submission

        $(".exit").on('click', function(){
            $("#title-update")[0].reset();
            $(".err-circle").html('');
            $(".message-box").css("display", "none");
        });

        var id = $("#id_title").val();
        var title_url = $(this).attr("action");
        var form_edit = $(this).serialize();

            $.ajax({
                type: 'POST',
                url: title_url,
                data: form_edit,
                dataType: 'json',
                success: function(output){
                    if(output.status == 1){                                         //if validation, show success message
                        $(".err").html('');                                         //set error messages to empty
                        $(".err-circle-span")
                            .removeClass('alert-danger')
                            .addClass('alert-success')
                            .html('<i class="bi bi-check-lg"></i>')                 //add check icon into span element
                            .fadeOut(2500);                                                                                   
                        $(".message-box")
                            .removeClass('alert-danger')
                            .addClass('alert-success')
                            .css('display', 'block')
                            .fadeIn(1500, function(){
                                $(".successUpdate").text(output.msg)                //insert success message
                                    .css('display', 'inline-block')
                                    .fadeIn(1500, function(){       
                                        $("#title-update")[1].reset();              //reset form input data after success submition
                                    }); 
                                });   

                        $(".exit").on('click', function(){     
                            parent.location.reload();
                        });                
                    } else{
                        $(".successUpdate").css('display', 'none');
                        $(".message-box")
                            .removeClass('alert-success')
                            .addClass('alert-danger')
                            .css('display', 'block')
                            .fadeIn(1500);

                                if(output.errUpdateName){
                                    $("#numUpdateN .err-circle-span")
                                        .removeClass('alert-success')
                                        .addClass('alert-danger')
                                        .html('<b>* I </b>')
                                        .fadeIn();
                                    $(".errUpdateName")
                                        .html('<b>* I :</b> ' + output.errUpdateName + '&nbsp;')
                                        .css('display', 'inline-block');
                                } else{
                                    $("#numUpdateN .err-circle-span")
                                        .removeClass('alert-danger')
                                        .addClass('alert-success')
                                        .html('<i class="bi bi-check-lg"></i>')
                                        .fadeIn();
                                    $(".errUpdateName").css('display', 'none');
                                } 

                                if(output.errUpdateTitle){
                                    $("#numUpdateT .err-circle-span")
                                        .removeClass('alert-success')
                                        .addClass('alert-danger')
                                        .html('<b>* II </b>')
                                        .fadeIn();
                                    $(".errUpdateTitle")
                                        .html('&nbsp;<b>* II :</b> ' + output.errUpdateTitle + '&nbsp;')
                                        .css('display', 'inline-block');
                                } else{
                                    $("#numUpdateT .err-circle-span")
                                        .removeClass('alert-danger')
                                        .addClass('alert-success')
                                        .html('<i class="bi bi-check-lg"></i>')
                                        .fadeIn();
                                    $(".errUpdateTitle").css('display', 'none');
                                }; 

                                if(output.errUpdateAcronym){
                                    $("#numUpdateA .err-circle-span")
                                        .removeClass('alert-success')
                                        .addClass('alert-danger')
                                        .html('<b>* III </b>')
                                        .fadeIn();
                                    $(".errUpdateAcronym")
                                        .html('&nbsp;<b>* III :</b> ' + output.errUpdateAcronym)
                                        .css('display', 'inline-block');
                                } else{
                                    $("#numUpdateA .err-circle-span")
                                        .removeClass('alert-danger')
                                        .addClass('alert-success')
                                        .html('<i class="bi bi-check-lg"></i>')
                                        .fadeIn();
                                    $(".errUpdateAcronym").css('display', 'none');
                                } 

                        $(".exit").on('click', function(){     
                            parent.location.reload();
                        });
                    }
                    console.log(output);
                }
            })
    });
//  ===> END FORM VALIDATION AND SUBMIT
});
</script>
{% endblock %}