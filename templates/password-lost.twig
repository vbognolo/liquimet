{% extends 'layout.twig' %}
{% block title %} Login {% endblock %}

{% block body %}
<body id="login" class="d-flex justify-content-center align-items-center">
    <div class="container d-flex justify-content-center h-100">
        <div class="container col-4 my-auto user-card">
            
            <div class="container d-flex justify-content-center">
                <div class="d-flex justify-content-center logo-box">
                    <img src="/img/logo_liquimet.png" class="brand-logo" alt="Liquimet Logo">
                </div>
            </div>
            
            <div class="container form-box">
                <form id="forgot-password-form" method="POST" action="password-lost" class="col-9 justify-content-center mx-auto my-auto">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">

                    <div class="input-group mx-auto my-2 input-login">
                        <label for="login-email" class="input-group-text">
                            <i class="bi bi-envelope-at"></i>
                        </label>
                        
                        <input type="text" id="login-email" name="login-email" class="form-control" placeholder="e-mail" autocomplete="off" />   
                    </div>
    
                    <div class="col-8 mx-auto my-4 btn-box">
                        <button type="submit" name="send" class="btn login-btn" id="login-btn" value="Invia">
                            INVIA
                        </button>
                    </div>
                </form>
            </div>	
            
            <div class="col-9 mx-auto {% if error %}alert alert-danger{% endif %}">
                {{ error }}
            </div>

            <div class="mt-4">
                <div class="d-flex justify-content-center links">
                    <a href="login" id="back-to-login">
                        Torna al login
                    </a>
                </div>
            </div>
        </div>
    </div>
</body>
{% endblock %}

{% block scripts %}
    {# jQuery (must be first) #}
<script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" 
        crossorigin="anonymous">
</script>
    {# jQuery Validation (depends on jQuery) #}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.21.0/jquery.validate.min.js" 
        integrity="sha512-KFHXdr2oObHKI9w4Hv1XPKc898mE4kgYx58oqsc/JqqdLMDI4YjOLzom+EMlW8HFUd0QfjfAvxSL6sEq/a42fQ==" 
        crossorigin="anonymous" 
        referrerpolicy="no-referrer">
</script>
    {# jQuery Additional Methods (depends on jQuery) #}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.21.0/additional-methods.min.js" 
        integrity="sha512-owaCKNpctt4R4oShUTTraMPFKQWG9UdWTtG6GRzBjFV4VypcFi6+M3yc4Jk85s3ioQmkYWJbUl1b2b2r41RTjA==" 
        crossorigin="anonymous" 
        referrerpolicy="no-referrer">
</script>
    {# Bootstrap JS bundle (includes modal) #}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" 
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" 
        crossorigin="anonymous">
</script> 
<script>
$(document).ready(function() {
    $("#forgot-password-form").validate({
        rules: {
            email: {
                required: true,
                email: true
            }
        },
        messages: {
            email: {
                required: "Campo obbligatorio.",
                email: "Indirizzo e-mail non valido."
            }
        },
        submitHandler: function(form) {
            $.ajax({
                type: "POST",
                url: "password-lost",
                data: $(form).serialize(),
                dataType: "json",
                success: function(response) {
                    if (response.success) {
                        $("#forgot-message").html('<div class="alert alert-success">Se esiste un account, riceverai una email.</div>');
                    } else {
                        $("#forgot-message").html('<div class="alert alert-danger">Errore durante l\'invio della email.</div>');
                    }
                },
                error: function() {
                    $("#forgot-message").html('<div class="alert alert-danger">Errore di connessione al server.</div>');
                }
            });
        }
    });
});
</script>
{% endblock %}